"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _style=require("../style");var _ImageRoll=_interopRequireDefault(require("./ImageRoll"));var _index=_interopRequireDefault(require("./style/index"));function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2["default"])(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2["default"])(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var ImagePicker=function(_React$Component){(0,_inherits2["default"])(ImagePicker,_React$Component);var _super=_createSuper(ImagePicker);function ImagePicker(props){var _this;(0,_classCallCheck2["default"])(this,ImagePicker);_this=_super.call(this,props);_this.onPressIn=function(styles){return function(){_this.plusWrap.setNativeProps({style:[styles.item,styles.size,styles.plusWrapHighlight]});};};_this.onPressOut=function(styles){return function(){_this.plusWrap.setNativeProps({style:[styles.item,styles.size,styles.plusWrapNormal]});};};_this.showPicker=function(){if(_this.props.onAddImageClick){_this.props.onAddImageClick();return;}_this.setState({visible:true});};_this.hideImageRoll=function(){_this.setState({visible:false});if(_this.props.onFail){_this.props.onFail('cancel image selection');}};_this.state={visible:false};return _this;}(0,_createClass2["default"])(ImagePicker,[{key:"addImage",value:function addImage(imageObj){if(!imageObj.url){imageObj.url=imageObj.uri;delete imageObj.uri;}var _this$props$files=this.props.files,files=_this$props$files===void 0?[]:_this$props$files;var newImages=files.concat(imageObj);if(this.props.onChange){this.props.onChange(newImages,'add');}}},{key:"removeImage",value:function removeImage(idx){var newImages=[];var _this$props$files2=this.props.files,files=_this$props$files2===void 0?[]:_this$props$files2;files.forEach(function(image,index){if(index!==idx){newImages.push(image);}});if(this.props.onChange){this.props.onChange(newImages,'remove',idx);}}},{key:"onImageClick",value:function onImageClick(index){if(this.props.onImageClick){this.props.onImageClick(index,this.props.files);}}},{key:"render",value:function render(){var _this2=this;var _this$props=this.props,_this$props$files3=_this$props.files,files=_this$props$files3===void 0?[]:_this$props$files3,selectable=_this$props.selectable,cameraPickerProps=_this$props.cameraPickerProps;return _react["default"].createElement(_style.WithTheme,{styles:this.props.styles,themeStyles:_index["default"]},function(styles){var filesView=files.map(function(item,index){return _react["default"].createElement(_reactNative.View,{key:index,style:[styles.item,styles.size]},_react["default"].createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){return _this2.onImageClick(index);},activeOpacity:0.6},_react["default"].createElement(_reactNative.Image,{source:{uri:item.url},style:[styles.size,styles.image]})),_react["default"].createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){return _this2.removeImage(index);},style:styles.closeWrap,activeOpacity:0.6},_react["default"].createElement(_reactNative.Text,{style:styles.closeText},"\xD7")));});var imageRollEl=_react["default"].createElement(_ImageRoll["default"],{onCancel:_this2.hideImageRoll,onSelected:function onSelected(imgObj){return _this2.addImage(imgObj);},title:_this2.props.title,cancelText:_this2.props.cancelText,cameraPickerProps:cameraPickerProps});return _react["default"].createElement(_reactNative.View,{style:styles.container},filesView,selectable&&_react["default"].createElement(_reactNative.TouchableWithoutFeedback,{onPress:_this2.showPicker,onPressIn:_this2.onPressIn(styles),onPressOut:_this2.onPressOut(styles)},_react["default"].createElement(_reactNative.View,{ref:function ref(conponent){return _this2.plusWrap=conponent;},style:[styles.item,styles.size,styles.plusWrap,styles.plusWrapNormal]},_react["default"].createElement(_reactNative.Text,{style:[styles.plusText]},"+"))),_this2.state.visible?imageRollEl:null);});}}]);return ImagePicker;}(_react["default"].Component);exports["default"]=ImagePicker;ImagePicker.defaultProps={onChange:function onChange(){},onFail:function onFail(){},files:[],selectable:true};