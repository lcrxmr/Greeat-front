"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _classnames=_interopRequireDefault(require("classnames"));var _useMergedState3=_interopRequireDefault(require("rc-util/lib/hooks/useMergedState"));var React=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _activityIndicator=_interopRequireDefault(require("../activity-indicator"));var _ButtonWave=_interopRequireDefault(require("../button/ButtonWave"));var _style=require("../style");var _index=_interopRequireDefault(require("../view/index"));var _devWarning=_interopRequireDefault(require("../_util/devWarning"));var _useAnimations=require("../_util/hooks/useAnimations");var _index2=_interopRequireDefault(require("./style/index"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj);}return newObj;}var __rest=void 0&&(void 0).__rest||function(s,e){var t={};for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];}if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]];}return t;};var AnimatedView=_reactNative.Animated.createAnimatedComponent(_index["default"]);var AntmSwitch=function AntmSwitch(_a){var _a$prefixCls=_a.prefixCls,prefixCls=_a$prefixCls===void 0?'switch':_a$prefixCls,checked=_a.checked,defaultChecked=_a.defaultChecked,disabled=_a.disabled,color=_a.color,loading=_a.loading,checkedChildren=_a.checkedChildren,unCheckedChildren=_a.unCheckedChildren,onPress=_a.onPress,onChange=_a.onChange,trackColor=_a.trackColor,thumbColor=_a.thumbColor,thumbTintColor=_a.thumbTintColor,restProps=__rest(_a,["prefixCls","checked","defaultChecked","disabled","color","loading","checkedChildren","unCheckedChildren","onPress","onChange","trackColor","thumbColor","thumbTintColor"]);(0,_devWarning["default"])('checked'in restProps||!('value'in restProps),'Switch','`value` is not a valid prop, do you mean `checked`?');var checkedRef=React.useRef();if(checkedRef.current===undefined){checkedRef.current=checked!==null&&checked!==void 0?checked:defaultChecked;}var _useMergedState=(0,_useMergedState3["default"])(false,{value:checkedRef.current,defaultValue:defaultChecked}),_useMergedState2=(0,_slicedToArray2["default"])(_useMergedState,2),innerChecked=_useMergedState2[0],setInnerChecked=_useMergedState2[1];disabled=disabled||loading;var _useAnimatedTiming=(0,_useAnimations.useAnimatedTiming)(),_useAnimatedTiming2=(0,_slicedToArray2["default"])(_useAnimatedTiming,2),animatedValue=_useAnimatedTiming2[0],animate=_useAnimatedTiming2[1];var transitionMargin={marginLeft:animatedValue.interpolate({inputRange:[0,1],outputRange:[25,7]}),marginRight:animatedValue.interpolate({inputRange:[0,1],outputRange:[7,25]})};var _useAnimatedTiming3=(0,_useAnimations.useAnimatedTiming)(),_useAnimatedTiming4=(0,_slicedToArray2["default"])(_useAnimatedTiming3,2),animatedValue2=_useAnimatedTiming4[0],animate2=_useAnimatedTiming4[1];var transitionWidth={width:animatedValue2.interpolate({inputRange:[0,1],outputRange:[22,28]}),left:!innerChecked?animatedValue.interpolate({inputRange:[0,1],outputRange:[0,10]}):undefined,right:innerChecked?animatedValue.interpolate({inputRange:[0,1],outputRange:[10,0]}):0};React.useEffect(function(){if(checkedRef.current){animate({});animate2({toValue:0});}else{animate({toValue:0});}},[animate,animate2,checkedRef]);function triggerChange(newChecked){if(!disabled){checkedRef.current=newChecked;setInnerChecked(newChecked);onChange===null||onChange===void 0?void 0:onChange(newChecked);return newChecked;}return innerChecked;}function onInternalClick(){var ret=triggerChange(!innerChecked);onPress===null||onPress===void 0?void 0:onPress(ret);animate({toValue:ret?1:0});}function onPressIn(){animate2({easing:_reactNative.Easing.inOut(_reactNative.Easing.ease)});}function onPressOut(){animate2({toValue:0,easing:_reactNative.Easing.inOut(_reactNative.Easing.ease)});}return React.createElement(_style.WithTheme,{styles:restProps.styles,themeStyles:_index2["default"]},function(styles,theme){var _classNames,_classNames2,_classNames3;var ant_switch=(0,_classnames["default"])(prefixCls,(_classNames={},(0,_defineProperty2["default"])(_classNames,"".concat(prefixCls,"_checked"),innerChecked),(0,_defineProperty2["default"])(_classNames,"".concat(prefixCls,"_unchecked"),!innerChecked),(0,_defineProperty2["default"])(_classNames,"".concat(prefixCls,"_checked_disabled"),innerChecked&&disabled),(0,_defineProperty2["default"])(_classNames,"".concat(prefixCls,"_unchecked_disabled"),!innerChecked&&disabled),_classNames)).split(' ').map(function(a){return styles[a];});var ant_switch_inner=(0,_classnames["default"])("".concat(prefixCls,"_inner"),(_classNames2={},(0,_defineProperty2["default"])(_classNames2,"".concat(prefixCls,"_inner_checked"),innerChecked),(0,_defineProperty2["default"])(_classNames2,"".concat(prefixCls,"_inner_unchecked"),!innerChecked),_classNames2)).split(' ').map(function(a){return styles[a];});var ant_switch_handle=(0,_classnames["default"])("".concat(prefixCls,"_handle"),(_classNames3={},(0,_defineProperty2["default"])(_classNames3,"".concat(prefixCls,"_handle_checked"),innerChecked),(0,_defineProperty2["default"])(_classNames3,"".concat(prefixCls,"_handle_unchecked"),!innerChecked),(0,_defineProperty2["default"])(_classNames3,"".concat(prefixCls,"_handle_disabled"),disabled),_classNames3)).split(' ').map(function(a){return styles[a];});var Color=innerChecked?color||(trackColor===null||trackColor===void 0?void 0:trackColor["true"])||theme.switch_fill:(trackColor===null||trackColor===void 0?void 0:trackColor["false"])||theme.switch_unchecked;var SwitchTrackColor={backgroundColor:Color,borderColor:Color,opacity:Color?disabled?0.6:1:1};var SwitchThumbColor=JSON.parse(JSON.stringify({backgroundColor:innerChecked?thumbTintColor:thumbColor}));var accessibilityState={checked:innerChecked,disabled:disabled,busy:loading};return React.createElement(_reactNative.View,{accessibilityRole:"switch",accessibilityState:accessibilityState,style:[styles[prefixCls],{padding:1}]},React.createElement(_ButtonWave["default"],(0,_extends2["default"])({},restProps,{Color:Color,disabled:disabled,onPressIn:onPressIn,onPressOut:onPressOut,onPress:onInternalClick}),React.createElement(_reactNative.View,{style:[ant_switch,Boolean(trackColor||color)&&SwitchTrackColor]},React.createElement(_reactNative.Animated.View,{style:[ant_switch_handle,SwitchThumbColor,transitionWidth]},loading&&React.createElement(_activityIndicator["default"],{color:Color,size:18,styles:{spinner:{padding:2,opacity:0.4}}})),React.createElement(AnimatedView,{style:[ant_switch_inner,transitionMargin]},innerChecked?checkedChildren:unCheckedChildren))));});};AntmSwitch.displayName='AntmSwitch';var _default=AntmSwitch;exports["default"]=_default;