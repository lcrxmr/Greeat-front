"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.getDefaultProps=getDefaultProps;exports["default"]=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _arrayTreeFilter=_interopRequireDefault(require("array-tree-filter"));var _react=_interopRequireDefault(require("react"));var _localeProvider=require("../locale-provider");var _style=require("../style");var _getLocale=require("../_util/getLocale");var _cascader=_interopRequireDefault(require("./cascader"));var _Popup=_interopRequireDefault(require("./cascader/Popup"));var _MultiPicker=_interopRequireDefault(require("./MultiPicker"));var _Picker=_interopRequireDefault(require("./Picker"));var _style2=_interopRequireDefault(require("./style"));function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2["default"])(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2["default"])(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var __rest=void 0&&(void 0).__rest||function(s,e){var t={};for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];}if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]];}return t;};function getDefaultProps(){var defaultFormat=function defaultFormat(values){return values.join(',');};return{triggerType:'onPress',prefixCls:'am-picker',pickerPrefixCls:'am-picker-col',popupPrefixCls:'am-picker-popup',format:defaultFormat,cols:3,cascade:true,title:''};}var Picker=function(_React$Component){(0,_inherits2["default"])(Picker,_React$Component);var _super=_createSuper(Picker);function Picker(){var _this;(0,_classCallCheck2["default"])(this,Picker);_this=_super.apply(this,arguments);_this.getSel=function(){var value=_this.props.value||[];var treeChildren;var data=_this.props.data;if(_this.props.cascade){treeChildren=(0,_arrayTreeFilter["default"])(data,function(c,level){return c.value===value[level];});}else{treeChildren=value.map(function(v,i){return data[i].filter(function(d){return d.value===v;})[0];});}return _this.props.format&&_this.props.format(treeChildren.map(function(v){return v.label;}));};_this.getPickerCol=function(){var _this$props=_this.props,data=_this$props.data,itemStyle=_this$props.itemStyle,indicatorStyle=_this$props.indicatorStyle;return(Array.isArray(data[0])?data:[data]).map(function(col,index){return _react["default"].createElement(_Picker["default"],{key:index,style:{flex:1},itemStyle:itemStyle,indicatorStyle:indicatorStyle},col.map(function(item){return _react["default"].createElement(_Picker["default"].Item,{key:item.value,value:item.value},item.label);}));});};_this.onOk=function(v){if(_this.scrollValue!==undefined){v=_this.scrollValue;}if(_this.props.onChange){_this.props.onChange(v);}if(_this.props.onOk){_this.props.onOk(v);}};_this.setScrollValue=function(v){_this.scrollValue=v;};_this.setCasecadeScrollValue=function(v){if(v&&_this.scrollValue){var length=_this.scrollValue.length;if(length===v.length&&_this.scrollValue[length-1]===v[length-1]){return;}}_this.setScrollValue(v);};_this.fixOnOk=function(cascader){if(cascader&&cascader.onOk!==_this.onOk){cascader.onOk=_this.onOk;cascader.forceUpdate();}};_this.onPickerChange=function(v){_this.setScrollValue(v);if(_this.props.onPickerChange){_this.props.onPickerChange(v);}};_this.onVisibleChange=function(visible){_this.setScrollValue(undefined);if(_this.props.onVisibleChange){_this.props.onVisibleChange(visible);}};_this.getCascade=function(cascade,data,cols,itemStyle,indicatorStyle){var cascader;var popupMoreProps={};if(cascade){cascader=_react["default"].createElement(_cascader["default"],{data:Array.isArray(data[0])?data[0]:data,cols:cols,onChange:_this.onPickerChange,onScrollChange:_this.setCasecadeScrollValue,pickerItemStyle:itemStyle,indicatorStyle:indicatorStyle});}else{cascader=_react["default"].createElement(_MultiPicker["default"],{style:{flexDirection:'row',alignItems:'center'},onScrollChange:_this.setScrollValue,onValueChange:_this.onPickerChange},_this.getPickerCol());popupMoreProps={pickerValueProp:'selectedValue',pickerValueChangeProp:'onValueChange'};}return{cascader:cascader,popupMoreProps:popupMoreProps};};return _this;}(0,_createClass2["default"])(Picker,[{key:"render",value:function render(){var _this2=this;var _a=this.props,children=_a.children,_a$value=_a.value,value=_a$value===void 0?[]:_a$value,popupPrefixCls=_a.popupPrefixCls,itemStyle=_a.itemStyle,indicatorStyle=_a.indicatorStyle,okText=_a.okText,dismissText=_a.dismissText,extra=_a.extra,cascade=_a.cascade,data=_a.data,cols=_a.cols,onOk=_a.onOk,restProps=__rest(_a,["children","value","popupPrefixCls","itemStyle","indicatorStyle","okText","dismissText","extra","cascade","data","cols","onOk"]);var _locale=(0,_getLocale.getComponentLocale)(this.props,this.context,'Picker',function(){return require('./locale/zh_CN');});var _this$getCascade=this.getCascade(cascade,data,cols,itemStyle,indicatorStyle),cascader=_this$getCascade.cascader,popupMoreProps=_this$getCascade.popupMoreProps;return _react["default"].createElement(_style.WithTheme,{styles:restProps.styles,themeStyles:_style2["default"]},function(styles){return _react["default"].createElement(_Popup["default"],(0,_extends2["default"])({cascader:cascader},_this2.popupProps,restProps,{styles:styles,value:value,dismissText:dismissText||_locale.dismissText,okText:okText||_locale.okText},popupMoreProps,{ref:_this2.fixOnOk,onVisibleChange:_this2.onVisibleChange}),children&&typeof children!=='string'&&_react["default"].isValidElement(children)&&_react["default"].cloneElement(children,{extra:_this2.getSel()||extra||_locale.extra}));});}}]);return Picker;}(_react["default"].Component);exports["default"]=Picker;Picker.contextType=_localeProvider.LocaleContext;Picker.defaultProps=getDefaultProps();