"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _arrayTreeFilter=_interopRequireDefault(require("array-tree-filter"));var _react=_interopRequireDefault(require("react"));var _MultiPicker=_interopRequireDefault(require("../MultiPicker"));var _Picker=_interopRequireDefault(require("../Picker"));function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2["default"])(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2["default"])(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var Cascader=function(_React$Component){(0,_inherits2["default"])(Cascader,_React$Component);var _super=_createSuper(Cascader);function Cascader(){var _this;(0,_classCallCheck2["default"])(this,Cascader);_this=_super.apply(this,arguments);_this.state={value:_this.getValue(_this.props.data,_this.props.defaultValue||_this.props.value)};_this.onValueChange=function(value,index){var children=(0,_arrayTreeFilter["default"])(_this.props.data,function(c,level){return level<=index&&c.value===value[level];});var data=children[index];var i;for(i=index+1;data&&data.children&&data.children.length&&i<_this.props.cols;i++){data=data.children[0];value[i]=data.value;}value.length=i;if(!('value'in _this.props)){_this.setState({value:value});}if(_this.props.onChange){_this.props.onChange(value);}};return _this;}(0,_createClass2["default"])(Cascader,[{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(nextProps){if('value'in nextProps){this.setState({value:this.getValue(nextProps.data,nextProps.value)});}}},{key:"getValue",value:function getValue(d,val){var data=d||this.props.data;var value=val||this.props.value||this.props.defaultValue;var level=0;var nextValue=[];if(value&&value.length){do{var index=data.findIndex(function(item){return item.value===value[level];});if(index<0){break;}nextValue[level]=value[level];level+=1;data=data[index].children||[];}while(data.length>0);}for(var i=level;i<this.props.cols;i++){if(data&&data.length){nextValue[i]=data[0].value;data=data[0].children;}else{break;}}return nextValue;}},{key:"getCols",value:function getCols(){var _this$props=this.props,data=_this$props.data,cols=_this$props.cols,disabled=_this$props.disabled,pickerItemStyle=_this$props.pickerItemStyle,indicatorStyle=_this$props.indicatorStyle;var value=this.state.value;var childrenTree=(0,_arrayTreeFilter["default"])(data,function(c,level){return c.value===value[level];}).map(function(c){return c.children;});var needPad=cols-childrenTree.length;if(needPad>0){for(var i=0;i<needPad;i++){childrenTree.push([]);}}childrenTree.length=cols-1;childrenTree.unshift(data);return childrenTree.map(function(){var children=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var level=arguments.length>1?arguments[1]:undefined;return _react["default"].createElement(_Picker["default"],{key:level,style:{flex:1},disabled:disabled,itemStyle:pickerItemStyle,indicatorStyle:indicatorStyle},children.map(function(item){return _react["default"].createElement(_Picker["default"].Item,{value:item.value,key:item.value},item.label);}));});}},{key:"render",value:function render(){var props=this.props;var rootNativeProps=props.rootNativeProps,style=props.style;var cols=this.getCols();return _react["default"].createElement(_MultiPicker["default"],{style:[{flexDirection:'row',alignItems:'center'},style],selectedValue:this.state.value,rootNativeProps:rootNativeProps,onValueChange:this.onValueChange,onScrollChange:props.onScrollChange},cols);}}]);return Cascader;}(_react["default"].Component);Cascader.defaultProps={cols:3,data:[],disabled:false};var _default=Cascader;exports["default"]=_default;