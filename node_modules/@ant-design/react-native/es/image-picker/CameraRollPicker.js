var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _cameraroll=_interopRequireDefault(require("@react-native-community/cameraroll"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _listView=_interopRequireDefault(require("../list-view"));var _ImageItem=_interopRequireDefault(require("./ImageItem"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2["default"])(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2["default"])(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};var styles=_reactNative.StyleSheet.create({wrapper:{flex:1},row:{flexDirection:'row',flex:1},marker:{position:'absolute',top:5,backgroundColor:'transparent'},spinner:{}});var CameraRollPicker=function(_Component){(0,_inherits2["default"])(CameraRollPicker,_Component);var _super=_createSuper(CameraRollPicker);function CameraRollPicker(props){var _this;(0,_classCallCheck2["default"])(this,CameraRollPicker);_this=_super.call(this,props);_this.onFetch=function(){var _=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var startFetch=arguments.length>1?arguments[1]:undefined;var abortFetch=arguments.length>2?arguments[2]:undefined;return __awaiter((0,_assertThisInitialized2["default"])(_this),void 0,void 0,_regenerator["default"].mark(function _callee(){var _this$props,assetType,groupTypes,first,groupName,mimeTypes,params,res,data;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_this$props=this.props,assetType=_this$props.assetType,groupTypes=_this$props.groupTypes,first=_this$props.first,groupName=_this$props.groupName,mimeTypes=_this$props.mimeTypes;params={first:first,after:this.after,assetType:assetType,groupName:groupName,mimeTypes:mimeTypes};if(_reactNative.Platform.OS!=='android'){params.groupTypes=groupTypes;}_context.next=6;return _cameraroll["default"].getPhotos(params);case 6:res=_context.sent;if(res){data=res.edges;if(res.page_info){this.after=res.page_info.has_next_page?res.page_info.end_cursor:'';}startFetch(data,first);}_context.next=14;break;case 10:_context.prev=10;_context.t0=_context["catch"](0);if(__DEV__){console.error(_context.t0);}abortFetch();case 14:case"end":return _context.stop();}}},_callee,this,[[0,10]]);}));};_this._renderImage=function(item){var selected=_this.state.selected;var _this$props2=_this.props,imageMargin=_this$props2.imageMargin,selectedMarker=_this$props2.selectedMarker,imagesPerRow=_this$props2.imagesPerRow,containerWidth=_this$props2.containerWidth;var uri=item.node.image.uri;var isSelected=_this._arrayObjectIndexOf(selected,'uri',uri)>=0?true:false;return _react["default"].createElement(_ImageItem["default"],{key:uri,item:item,selected:isSelected,imageMargin:imageMargin,selectedMarker:selectedMarker,imagesPerRow:imagesPerRow,containerWidth:containerWidth,onPress:_this._selectImage.bind((0,_assertThisInitialized2["default"])(_this))});};_this.state={images:[],selected:_this.props.selected};return _this;}(0,_createClass2["default"])(CameraRollPicker,[{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(nextProps){this.setState({selected:nextProps.selected});}},{key:"render",value:function render(){var _this2=this;var _this$props3=this.props,imageMargin=_this$props3.imageMargin,backgroundColor=_this$props3.backgroundColor,imagesPerRow=_this$props3.imagesPerRow;return _react["default"].createElement(_reactNative.View,{style:[styles.wrapper,{padding:imageMargin,paddingRight:0,backgroundColor:backgroundColor}]},_react["default"].createElement(_listView["default"],{onFetch:this.onFetch,refreshable:false,numColumns:imagesPerRow,renderItem:function renderItem(item){return _this2._renderImage(item);}}));}},{key:"_selectImage",value:function _selectImage(image){var _this$props4=this.props,maximum=_this$props4.maximum,callback=_this$props4.callback,selectSingleItem=_this$props4.selectSingleItem;var selected=this.state.selected;var index=this._arrayObjectIndexOf(selected,'uri',image.uri);if(index>=0){selected.splice(index,1);}else{if(selectSingleItem){selected.splice(0,selected.length);}if(selected.length<maximum){selected.push(image);}}this.setState({selected:selected});callback(selected,image);}},{key:"_nEveryRow",value:function _nEveryRow(data,n){var result=[];var temp=[];for(var i=0;i<data.length;++i){if(i>0&&i%n===0){result.push(temp);temp=[];}temp.push(data[i]);}if(temp.length>0){while(temp.length!==n){temp.push(null);}result.push(temp);}return result;}},{key:"_arrayObjectIndexOf",value:function _arrayObjectIndexOf(array,property,value){return array.map(function(o){return o[property];}).indexOf(value);}}]);return CameraRollPicker;}(_react.Component);CameraRollPicker.defaultProps={groupTypes:'SavedPhotos',maximum:15,imagesPerRow:6,imageMargin:4,first:50,selectSingleItem:false,assetType:'Photos',backgroundColor:'white',selected:[],callback:function callback(selectedImages,currentImage){console.log(currentImage);console.log(selectedImages);}};var _default=CameraRollPicker;exports["default"]=_default;